{
   "builders": [
      {
         "changes": [
            "ENTRYPOINT /usr/bin/supervisord --nodaemon",
            "EXPOSE 9100 9090"
         ],
         "commit": true,
         "image": "piinit/hashinode:latest",
         "pull": false,
         "type": "docker"
      }
   ],
   "post-processors": [
      [
         {
            "repository": "piinit/hashinode-mon",
            "tag": "latest",
            "type": "docker-tag"
         }
      ]
   ],
   "provisioners": [
      {
         "destination": "amd64",
         "generated": true,
         "source": "./packages/amd64",
         "type": "file"
      },
      {
         "destination": "all",
         "generated": true,
         "source": "./packages/all",
         "type": "file"
      },
      {
         "inline": [
            "apt-get update -y",
            "DEBIAN_FRONTEND=noninteractive apt-get install -y ./amd64/prometheus.deb ./amd64/consul_exporter.deb ./all/prometheus-local.deb ./all/consul-client.deb ./all/consul-local.deb ./all/node_exporter-supervisord.deb ./all/process-exporter-config.deb ./all/raspberrypi_exporter.deb"
         ],
         "type": "shell"
      },
      {
         "inline": [
            "supervisorctl stop consul",
            "rm -rf /opt/consul/data/*"
         ],
         "type": "shell"
      }
   ]
}
